<div class="add-book-container">
  <!-- Page Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h2 class="h3 mb-0 text-gradient">Add New Book</h2>
      <p class="text-muted mb-0">Add a new book to the library collection</p>
    </div>
    <a routerLink="/admin/books" class="btn btn-outline-secondary">
      <i class="fas fa-arrow-left me-2"></i>Back to Books
    </a>
  </div>

  <!-- Add Book Form -->
  <div class="card">
    <div class="card-header">
      <h5 class="card-title mb-0">
        <i class="fas fa-book me-2"></i>Book Information
      </h5>
    </div>
    <div class="card-body">
      <form [formGroup]="bookForm" (ngSubmit)="onSubmit()" novalidate>
        <div class="row">
          <!-- Book Cover Image -->
          <div class="col-md-4 mb-4">
            <div class="book-cover-section">
              <label class="form-label">Book Cover Image</label>
              <div class="image-upload-area" (click)="fileInput.click()">
                <div *ngIf="!imagePreview" class="upload-placeholder">
                  <i class="fas fa-camera fa-2x text-muted mb-2"></i>
                  <p class="text-muted">Click to upload cover image</p>
                  <small class="text-muted">JPG, PNG, GIF (Max: 2MB)</small>
                </div>
                <div *ngIf="imagePreview" class="image-preview">
                  <img [src]="imagePreview" alt="Book cover preview" class="img-fluid">
                  <div class="image-overlay">
                    <i class="fas fa-edit text-white"></i>
                  </div>
                </div>
              </div>
              <input
                #fileInput
                type="file"
                accept="image/*"
                (change)="onImageSelected($event)"
                style="display: none;"
              />
              <div class="invalid-feedback" *ngIf="imageError">
                {{ imageError }}
              </div>
            </div>
          </div>

          <!-- Book Details -->
          <div class="col-md-8">
            <div class="row">
              <!-- Book ID (Auto-generated) -->
              <div class="col-12 mb-3">
                <label class="form-label">Book ID</label>
                <input
                  type="text"
                  class="form-control"
                  value="Auto-generated"
                  readonly
                  disabled
                />
              </div>

              <!-- Book Title -->
              <div class="col-md-6 mb-3">
                <label for="title" class="form-label">Book Title <span class="text-danger">*</span></label>
                <input
                  type="text"
                  class="form-control"
                  id="title"
                  formControlName="title"
                  placeholder="Enter book title"
                  [class.is-invalid]="title?.invalid && (title?.dirty || title?.touched)"
                />
                <div class="invalid-feedback" *ngIf="title?.invalid && (title?.dirty || title?.touched)">
                  <div *ngIf="title?.errors?.['required']">Book title is required</div>
                  <div *ngIf="title?.errors?.['minlength']">Title must be at least 2 characters long</div>
                </div>
              </div>

              <!-- Author -->
              <div class="col-md-6 mb-3">
                <label for="author" class="form-label">Author <span class="text-danger">*</span></label>
                <input
                  type="text"
                  class="form-control"
                  id="author"
                  formControlName="author"
                  placeholder="Enter author name"
                  [class.is-invalid]="author?.invalid && (author?.dirty || author?.touched)"
                />
                <div class="invalid-feedback" *ngIf="author?.invalid && (author?.dirty || author?.touched)">
                  <div *ngIf="author?.errors?.['required']">Author name is required</div>
                  <div *ngIf="author?.errors?.['minlength']">Author name must be at least 2 characters long</div>
                </div>
              </div>

              <!-- Category -->
              <div class="col-md-6 mb-3">
                <label for="category" class="form-label">Category <span class="text-danger">*</span></label>
                <select
                  class="form-select"
                  id="category"
                  formControlName="category"
                  [class.is-invalid]="category?.invalid && (category?.dirty || category?.touched)"
                >
                  <option value="">Select a category</option>
                  <option *ngFor="let cat of bookCategories" [value]="cat">{{ cat }}</option>
                </select>
                <div class="invalid-feedback" *ngIf="category?.invalid && (category?.dirty || category?.touched)">
                  <div *ngIf="category?.errors?.['required']">Category is required</div>
                </div>
              </div>

              <!-- Total Copies -->
              <div class="col-md-6 mb-3">
                <label for="totalCopies" class="form-label">Total Copies <span class="text-danger">*</span></label>
                <input
                  type="number"
                  class="form-control"
                  id="totalCopies"
                  formControlName="totalCopies"
                  placeholder="Enter total copies"
                  min="1"
                  [class.is-invalid]="totalCopies?.invalid && (totalCopies?.dirty || totalCopies?.touched)"
                />
                <div class="invalid-feedback" *ngIf="totalCopies?.invalid && (totalCopies?.dirty || totalCopies?.touched)">
                  <div *ngIf="totalCopies?.errors?.['required']">Total copies is required</div>
                  <div *ngIf="totalCopies?.errors?.['min']">Must be at least 1 copy</div>
                </div>
              </div>

              <!-- Description -->
              <div class="col-12 mb-3">
                <label for="description" class="form-label">Description <span class="text-danger">*</span></label>
                <textarea
                  class="form-control"
                  id="description"
                  formControlName="description"
                  rows="4"
                  placeholder="Enter book description"
                  [class.is-invalid]="description?.invalid && (description?.dirty || description?.touched)"
                ></textarea>
                <div class="invalid-feedback" *ngIf="description?.invalid && (description?.dirty || description?.touched)">
                  <div *ngIf="description?.errors?.['required']">Description is required</div>
                  <div *ngIf="description?.errors?.['minlength']">Description must be at least 10 characters long</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="d-flex justify-content-end mt-4">
          <button
            type="button"
            class="btn btn-outline-secondary me-3"
            (click)="resetForm()"
            [disabled]="isSubmitting"
          >
            <i class="fas fa-undo me-2"></i>Reset
          </button>
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="bookForm.invalid || isSubmitting"
          >
            <span *ngIf="isSubmitting" class="spinner-border spinner-border-sm me-2"></span>
            <i class="fas fa-save me-2" *ngIf="!isSubmitting"></i>
            {{ isSubmitting ? 'Adding Book...' : 'Add Book' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" *ngIf="showSuccessModal">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">
          <i class="fas fa-check-circle me-2"></i>Book Added Successfully!
        </h5>
      </div>
      <div class="modal-body text-center py-4">
        <div class="mb-3">
          <i class="fas fa-book fa-3x text-success mb-3"></i>
          <h4>{{ addedBook?.title }}</h4>
          <p class="text-muted">by {{ addedBook?.author }}</p>
        </div>
        <div class="book-details">
          <p><strong>Book ID:</strong> {{ addedBook?.id }}</p>
          <p><strong>Category:</strong> {{ addedBook?.category }}</p>
          <p><strong>Total Copies:</strong> {{ addedBook?.totalCopies }}</p>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="addAnotherBook()">
          <i class="fas fa-plus me-2"></i>Add Another Book
        </button>
        <button type="button" class="btn btn-outline-primary" (click)="goToBooksList()">
          <i class="fas fa-list me-2"></i>View Books List
        </button>
      </div>
    </div>
  </div>
</div>
